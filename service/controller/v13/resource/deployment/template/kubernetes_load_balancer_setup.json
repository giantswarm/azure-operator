{
  "$schema":"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion":"1.0.0.0",
  "parameters":{
    "initialProvisioning":{
      "type":"string",
      "defaultValue":"Yes",
      "metadata":{
        "description":"Whether the deployment is provisioned the very first time."
      }
    },
    "ingressPIPName":{
      "defaultValue":"dummy-pip",
      "type":"string",
      "metadata":{
        "description":"Name of the allocated Public IP that is used for Ingress LB."
      }
    }
  },
  "variables":{
    "loadBalancerSkuName": "Standard"
  },
  "resources":[
    {
      "apiVersion":"2017-10-01",
      "type":"Microsoft.Network/publicIPAddresses",
      "name":"[parameters('ingressPIPName')]",
      "sku": {
        "name": "[variables('loadBalancerSkuName')]"
      },
      "location":"[resourceGroup().location]",
      "properties":{
        "publicIPAllocationMethod":"Static"
      }
    },
    {
      "apiVersion":"2017-10-01",
      "name":"kubernetes",
      "type":"Microsoft.Network/loadBalancers",
      "condition":"[equals(parameters('initialProvisioning'), 'Yes')]",
      "location":"[resourceGroup().location]",
      "sku": {
        "name": "[variables('loadBalancerSkuName')]"
      },
      "dependsOn":[
        "[concat('Microsoft.Network/publicIPAddresses/', parameters('ingressPIPName'))]"
      ],
      "properties":{
        "frontendIPConfigurations":[
          {
            "name":"dummy-frontend",
            "properties":{
              "publicIPAddress":{
                "id":"[resourceId('Microsoft.Network/publicIPAddresses', parameters('ingressPIPName'))]"
              }
            }
          }
        ],
        "backendAddressPools":[
          {
            "name":"kubernetes"
          }
        ]
      }
    }
  ]
}
