{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "domain": {
      "type": "string"
    },
    "ipAddress": {
      "type": "string"
    }
  },
  "variables": {
    "prefix": "[split(parameters('domain'), '.')[0]]",
    "prefixLength": "[add(length(variables('prefix')), 1)]",
    "zone": "[substring(parameters('domain'), variables('prefixLength'), sub(length(parameters('domain')), variables('prefixLength')))]"
  },
  "resources": [
    {
      "type": "Microsoft.Network/dnszones",
      "name": "[variables('zone')]",
      "apiVersion": "2016-04-01",
      "location": "global",
      "properties": { }
    },
    {
      "type": "Microsoft.Network/dnszones/a",
      "name": "[concat(variables('zone'), '/', variables('prefix'))]",
      "apiVersion": "2016-04-01",
      "location": "global",
      "dependsOn": [
        "[variables('zone')]"
      ],
      "properties": {
        "TTL": 3600,
        "ARecords": [
          {
            "ipv4Address": "[parameters('ipAddress')]"
          }
        ]
      }
    }
  ]
}
